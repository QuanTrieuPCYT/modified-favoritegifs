(function(g,A,f,l,r,h,m,u,T,y,E,x){"use strict";const N=f.findByProps("openLazy","hideActionSheet"),{addFavoriteGIF:_,removeFavoriteGIF:$}=f.findByProps("addFavoriteGIF","removeFavoriteGIF");function D(o){const t=new URL(o).pathname;return t.substring(t.lastIndexOf("/")+1)}function F(o,t){const e=Math.max(...Object.values(o).map(function(i){return i.order}));return{format:t.format,src:t.src,url:t.url,width:t.width,height:t.height,order:e+1}}function k(o){const t=[];for(let e of o.embeds)e.type==="gifv"?t.push({src:e.video.url,url:e.url,width:e.thumbnail.width,height:e.thumbnail.height,format:2}):e.type==="image"?t.push({src:e.image.url,url:e.url,width:e.image.width,height:e.image.height,format:1}):e.type==="video"&&t.push({src:e.video.url,url:e.url,width:e.thumbnail.width,height:e.thumbnail.height,format:2,isVideo:!0});for(let e of o.attachments)e.content_type&&e.content_type.includes("image")?t.push({src:e.url,url:e.url,width:e.width,height:e.height,format:1}):e.content_type&&e.content_type.includes("video")&&t.push({src:e.url,url:e.url,width:e.width,height:e.height,format:2,isVideo:!0});return t}const L=function(o,t,e,i){return function(){const c=function(){$(o.url),h.showToast(`Removed ${i} from Favorites`,r.getAssetIDByName("check"))},d=function(){_(F(t.favoriteGifs.gifs,o)),h.showToast(`Added ${i} to Favorites`,r.getAssetIDByName("check"))};N.hideActionSheet(),e?u.storage.confirm?m.showConfirmationAlert({title:"Remove from Favorites",content:`Are you sure you want to remove ${i} from your favorites?`,confirmText:"Remove",cancelText:"Cancel",onConfirm:c}):c():o.isVideo?m.showConfirmationAlert({title:"Add video to Favorites",content:"If a video is the first entry in the GIF picker, on mobile this breaks the picker until a new valid item is added or the video is removed. It will only show on Desktop.",confirmText:"Add to Favorites",cancelText:"Cancel",onConfirm:d}):u.storage.confirm?m.showConfirmationAlert({title:"Add to Favorites",content:`Are you sure you want to add ${i} to your favorites?`,confirmText:"Add to Favorites",cancelText:"Cancel",onConfirm:d}):d()}},{ScrollView:M}=y.General,{FormSection:O,FormSwitchRow:V,FormIcon:z}=y.Forms;function j(){return T.useProxy(u.storage),React.createElement(M,{style:{flex:1}},React.createElement(O,{title:"Settings"},React.createElement(V,{label:"Confirm actions",subLabel:"Show a confirmation alert before performing actions",leading:React.createElement(z,{source:r.getAssetIDByName("alert")}),value:u.storage.confirm??!1,onValueChange:function(o){u.storage.confirm=o}})))}const{FormRow:I}=y.Forms,p=f.findByProps("ActionSheetRow")?.ActionSheetRow;function R(o){let{label:t,icon:e,onPress:i}=o;const c=l.stylesheet.createThemedStyleSheet({iconComponent:{width:24,height:24,tintColor:x.semanticColors.INTERACTIVE_NORMAL}});return p?React.createElement(p,{label:t,icon:React.createElement(p.Icon,{source:e,IconComponent:function(){return React.createElement(l.ReactNative.Image,{resizeMode:"cover",style:c.iconComponent,source:e})}}),onPress:function(){return i?.()}}):React.createElement(I,{label:t,leading:React.createElement(I.Icon,{source:e}),onPress:function(){return i?.()}})}const b=f.findByProps("openLazy","hideActionSheet"),U=f.findByStoreName("UserSettingsProtoStore"),{addFavoriteGIF:G,removeFavoriteGIF:B}=f.findByProps("addFavoriteGIF","removeFavoriteGIF"),H=A.before("openLazy",b,function(o){let[t,e,i]=o;const c=i?.message;e!=="MessageLongPressActionSheet"||!c||t.then(function(d){const q=A.after("default",d,function(Q,C){l.React.useEffect(function(){return function(){q()}},[]);const w=E.findInReactTree(C,function(n){return n?.[0]?.type?.name==="ButtonRow"});if(!w)return C;const S=k(c);if(S.length)for(let n of S){const a=U.frecencyWithoutFetchingLatest,P=Math.max(...Object.values(a.favoriteGifs.gifs).map(function(K){return K.order})),v=a.favoriteGifs.gifs[n.src]!==void 0||a.favoriteGifs.gifs[n.url]!==void 0,J=a.favoriteGifs.gifs[n.src]?.order===P||a.favoriteGifs.gifs[n.url]?.order===P,s=D(n.url);w.unshift(l.React.createElement(R,{label:v?`Remove ${s} from Favorites`:`Add ${s} to Favorites`,icon:v?r.getAssetIDByName("ic_clear"):r.getAssetIDByName("ic_star_filled"),onPress:L(n,a,v,s)})),v&&!J&&w.unshift(l.React.createElement(R,{label:`Bump ${s} to the top of Favorites`,icon:r.getAssetIDByName("ic_activity_24px"),onPress:function(){b.hideActionSheet(),u.storage.confirm?m.showConfirmationAlert({title:"Bump Favorite",content:`Are you sure you want to bump ${s} to the top of your favorites?`,confirmText:"Bump",onConfirm:function(){B(n.url),G(F(a.favoriteGifs.gifs,n)),h.showToast(`Bumped ${s} to the top of Favorites`,r.getAssetIDByName("check"))}}):(B(n.url),G(F(a.favoriteGifs.gifs,n)),h.showToast(`Bumped ${s} to the top of Favorites`,r.getAssetIDByName("check")))}}))}})})});var W={onUnload:function(){return H()},settings:j};return g.default=W,Object.defineProperty(g,"__esModule",{value:!0}),g})({},vendetta.patcher,vendetta.metro,vendetta.metro.common,vendetta.ui.assets,vendetta.ui.toasts,vendetta.ui.alerts,vendetta.plugin,vendetta.storage,vendetta.ui.components,vendetta.utils,vendetta.ui);
