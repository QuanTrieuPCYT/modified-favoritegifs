(function(g,w,f,u,y,r,l,h,c,x){"use strict";const T=f.findByProps("openLazy","hideActionSheet"),{addFavoriteGIF:$,removeFavoriteGIF:P}=f.findByProps("addFavoriteGIF","removeFavoriteGIF");function _(o){const t=new URL(o).pathname;return t.substring(t.lastIndexOf("/")+1)}function p(o,t){const e=Math.max(...Object.values(o).map(function(n){return n.order}));return{format:t.format,src:t.src,url:t.url,width:t.width,height:t.height,order:e+1}}function D(o){const t=[];for(let e of o.embeds)e.type==="gifv"?t.push({src:e.video.url,url:e.url,width:e.thumbnail.width,height:e.thumbnail.height,format:2}):e.type==="image"?t.push({src:e.image.url,url:e.url,width:e.image.width,height:e.image.height,format:1}):e.type==="video"&&t.push({src:e.video.url,url:e.url,width:e.thumbnail.width,height:e.thumbnail.height,format:2,isVideo:!0});for(let e of o.attachments)e.content_type&&e.content_type.includes("image")?t.push({src:e.url,url:e.url,width:e.width,height:e.height,format:1}):e.content_type&&e.content_type.includes("video")&&t.push({src:e.url,url:e.url,width:e.width,height:e.height,format:2,isVideo:!0});return t}const k=function(o,t,e,n){return function(){const m=function(){P(o.url),l.showToast(`Removed ${n} from Favorites`,r.getAssetIDByName("check"))},d=function(){$(p(t.favoriteGifs.gifs,o)),l.showToast(`Added ${n} to Favorites`,r.getAssetIDByName("check"))};T.hideActionSheet(),e?c.storage.confirm?h.showConfirmationAlert({title:"Remove from Favorites",content:`Are you sure you want to remove ${n} from your favorites?`,confirmText:"Remove",cancelText:"Cancel",onConfirm:m}):m():o.isVideo?h.showConfirmationAlert({title:"Add video to Favorites",content:"If a video is the first entry in the GIF picker, on mobile this breaks the picker until a new valid item is added or the video is removed. It will only show on Desktop.",confirmText:"Add to Favorites",cancelText:"Cancel",onConfirm:d}):c.storage.confirm?h.showConfirmationAlert({title:"Add to Favorites",content:`Are you sure you want to add ${n} to your favorites?`,confirmText:"Add to Favorites",cancelText:"Cancel",onConfirm:d}):d()}},{ScrollView:E}=y.General,{FormSection:N,FormSwitchRow:L,FormIcon:O}=y.Forms;function V(){return x.useProxy(c.storage),React.createElement(E,{style:{flex:1}},React.createElement(N,{title:"Settings"},React.createElement(L,{label:"Confirm actions",subLabel:"Show a confirmation alert before performing actions",leading:React.createElement(O,{source:r.getAssetIDByName("alert")}),value:c.storage.confirm??!1,onValueChange:function(o){c.storage.confirm=o}})))}const{FormRow:A,FormIcon:I}=y.Forms,G=f.findByProps("openLazy","hideActionSheet"),z=f.findByStoreName("UserSettingsProtoStore"),{addFavoriteGIF:b,removeFavoriteGIF:B}=f.findByProps("addFavoriteGIF","removeFavoriteGIF"),M=w.before("openLazy",G,function(o){const[t,e,n]=o;e==="MessageLongPressActionSheet"&&t.then(function(m){const d=w.after("default",m,function(J,j){u.React.useEffect(function(){return function(){d()}},[]);let[H,F]=j.props?.children?.props?.children?.props?.children;const R=H?.props?.message??n?.message;if(!F||!R)return;const C=D(R);if(C.length)for(let i of C){const a=z.frecencyWithoutFetchingLatest,S=Math.max(...Object.values(a.favoriteGifs.gifs).map(function(q){return q.order})),v=a.favoriteGifs.gifs[i.src]!==void 0||a.favoriteGifs.gifs[i.url]!==void 0,W=a.favoriteGifs.gifs[i.src]?.order===S||a.favoriteGifs.gifs[i.url]?.order===S,s=_(i.url);F.unshift(u.React.createElement(A,{label:v?`Remove ${s} from Favorites`:`Add ${s} to Favorites`,leading:u.React.createElement(I,{style:{opacity:1},source:v?r.getAssetIDByName("ic_clear"):r.getAssetIDByName("ic_star_filled")}),onPress:k(i,a,v,s)})),v&&!W&&F.unshift(u.React.createElement(A,{label:`Bump ${s} to the top of Favorites`,leading:u.React.createElement(I,{style:{opacity:1},source:r.getAssetIDByName("ic_activity_24px")}),onPress:function(){G.hideActionSheet(),c.storage.confirm?h.showConfirmationAlert({title:"Bump Favorite",content:`Are you sure you want to bump ${s} to the top of your favorites?`,confirmText:"Bump",onConfirm:function(){B(i.url),b(p(a.favoriteGifs.gifs,i)),l.showToast(`Bumped ${s} to the top of Favorites`,r.getAssetIDByName("check"))}}):(B(i.url),b(p(a.favoriteGifs.gifs,i)),l.showToast(`Bumped ${s} to the top of Favorites`,r.getAssetIDByName("check")))}}))}})})});var U={onUnload:function(){return M()},settings:V};return g.default=U,Object.defineProperty(g,"__esModule",{value:!0}),g})({},vendetta.patcher,vendetta.metro,vendetta.metro.common,vendetta.ui.components,vendetta.ui.assets,vendetta.ui.toasts,vendetta.ui.alerts,vendetta.plugin,vendetta.storage);
