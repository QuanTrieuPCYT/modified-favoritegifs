(function(a,f,o,i,g,v,u){"use strict";function p(t,e){const n=Math.max(...Object.values(t).map(function(s){return s.order}));return{format:e.format,src:e.url,width:e.width,height:e.height,order:n+1}}function F(t){for(let e of t.embeds){if(e.type==="gifv")return{url:e.url,width:e.thumbnail.width,height:e.thumbnail.height,format:2};if(e.type==="image"&&e.url.endsWith(".gif"))return{url:e.url,width:e.image.width,height:e.image.height,format:1}}for(let e of t.attachments)if(e.url.endsWith(".gif"))return{url:e.url,width:e.width,height:e.height,format:1};return null}const{FormRow:w,FormIcon:y}=g.Forms,c=o.findByProps("openLazy","hideActionSheet"),{addFavoriteGIF:G,removeFavoriteGIF:b}=o.findByProps("addFavoriteGIF","removeFavoriteGIF"),h=o.findByStoreName("UserSettingsProtoStore").frecencyWithoutFetchingLatest,R=f.before("openLazy",c,function(t){const[e,n,s]=t;n==="MessageLongPressActionSheet"&&e.then(function(I){const S=f.after("default",I,function(E,B){i.React.useEffect(function(){return function(){S()}},[]);let[L,d]=B.props?.children?.props?.children?.props?.children;const l=L?.props?.message??s?.message;if(!d||!l)return;const r=F(l);if(!r)return;const m=h.favoriteGifs.gifs[r.url]!==void 0;d.unshift(i.React.createElement(w,{label:m?"Remove from Favorites":"Add to Favorites",leading:i.React.createElement(y,{style:{opacity:1},source:v.getAssetIDByName("ic_star_filled")}),onPress:function(){if(c.hideActionSheet(),m)b(r.url),u.showToast("Removed from Favorites");else{const P={[r.url]:p(h.favoriteGifs.gifs,r)};G(P),u.showToast("Added to Favorites")}}}))})})}),A=function(){return R()};return a.onUnload=A,a})({},vendetta.patcher,vendetta.metro,vendetta.metro.common,vendetta.ui.components,vendetta.ui.assets,vendetta.ui.toasts);
