(function(h,p,d,a,b,n,c,B){"use strict";function _(o){const t=new URL(o).pathname;return t.substring(t.lastIndexOf("/")+1)}function u(o,t){const e=Math.max(...Object.values(o).map(function(v){return v.order}));return{format:t.format,src:t.src,url:t.url,width:t.width,height:t.height,order:e+1}}function R(o){const t=[];for(let e of o.embeds)e.type==="gifv"?t.push({src:e.video.url,url:e.url,width:e.thumbnail.width,height:e.thumbnail.height,format:2}):e.type==="image"?t.push({src:e.image.url,url:e.url,width:e.image.width,height:e.image.height,format:1}):e.type==="video"&&t.push({src:e.video.url,url:e.url,width:e.thumbnail.width,height:e.thumbnail.height,format:2,isVideo:!0});for(let e of o.attachments)e.content_type&&e.content_type.includes("image")?t.push({src:e.url,url:e.url,width:e.width,height:e.height,format:1}):e.content_type&&e.content_type.includes("video")&&t.push({src:e.url,url:e.url,width:e.width,height:e.height,format:2,isVideo:!0});return t}const{FormRow:y,FormIcon:F}=b.Forms,l=d.findByProps("openLazy","hideActionSheet"),D=d.findByStoreName("UserSettingsProtoStore"),{addFavoriteGIF:m,removeFavoriteGIF:w}=d.findByProps("addFavoriteGIF","removeFavoriteGIF"),k=p.before("openLazy",l,function(o){const[t,e,v]=o;e==="MessageLongPressActionSheet"&&t.then(function(P){const S=p.after("default",P,function(L,T){a.React.useEffect(function(){return function(){S()}},[]);let[$,g]=T.props?.children?.props?.children?.props?.children;const A=$?.props?.message??v?.message;if(!g||!A)return;const I=R(A);if(I.length)for(let i of I){const r=D.frecencyWithoutFetchingLatest,G=Math.max(...Object.values(r.favoriteGifs.gifs).map(function(E){return E.order})),f=r.favoriteGifs.gifs[i.src]!==void 0||r.favoriteGifs.gifs[i.url]!==void 0,x=r.favoriteGifs.gifs[i.src]?.order===G||r.favoriteGifs.gifs[i.url]?.order===G,s=_(i.url);g.unshift(a.React.createElement(y,{label:f?`Remove ${s} from Favorites`:`Add ${s} to Favorites`,leading:a.React.createElement(F,{style:{opacity:1},source:f?n.getAssetIDByName("ic_clear"):n.getAssetIDByName("ic_star_filled")}),onPress:function(){if(l.hideActionSheet(),f)w(i.url),c.showToast(`Removed ${s} from Favorites`,n.getAssetIDByName("check"));else{if(i.isVideo){B.showConfirmationAlert({title:"Add video to Favorites",content:"If a video is the first entry in the GIF picker, on mobile this breaks the picker until a new valid item is added or the video is removed. It will only show on Desktop.",confirmText:"Add to Favorites",cancelText:"Cancel",onConfirm:function(){m(u(r.favoriteGifs.gifs,i)),c.showToast(`Added ${s} to Favorites`,n.getAssetIDByName("check"))}});return}m(u(r.favoriteGifs.gifs,i)),c.showToast(`Added ${s} to Favorites`,n.getAssetIDByName("check"))}}})),f&&!x&&g.unshift(a.React.createElement(y,{label:`Bump ${s} to the top of Favorites`,leading:a.React.createElement(F,{style:{opacity:1},source:n.getAssetIDByName("ic_activity_24px")}),onPress:function(){l.hideActionSheet(),w(i.url),m(u(r.favoriteGifs.gifs,i)),c.showToast(`Bumped ${s} to the top of Favorites`,n.getAssetIDByName("check"))}}))}})})});var N={onUnload:function(){return k()}};return h.default=N,Object.defineProperty(h,"__esModule",{value:!0}),h})({},vendetta.patcher,vendetta.metro,vendetta.metro.common,vendetta.ui.components,vendetta.ui.assets,vendetta.ui.toasts,vendetta.ui.alerts);
